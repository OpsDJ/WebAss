<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7.3</title>
    <style>
      #panel { padding: .5em 1em 1em; }
      #loading { color: yellowgreen; }
    </style>
</head>
<body>
  <div id="panel">
    <p id="output"></p>								<!-- 用于呈现输出消息 -->
    <p id="loading">正在获取当前地理位置...</p>			<!-- 进度提示 -->
    <button onclick="writeClipboard()">写入剪切板</button>
  </div>
  
  <script>
    // 暂存输出消息的数组
    const result = []
    // 暂存页面上元素的引用, 便于后续使用
    const output = document.getElementById('output')
    const loading = document.getElementById('loading')

    // 将获取到的信息进行格式处理后存储到result数组中, 并更新#output的内容
    function addToResult(msg) {
      result.push(...Object.entries(msg).map(i => i.join(': ')))
      output.innerText = result.join('\n')
    }

    // 隐藏获取地址位置信息的进度提示
    function hideLoading() {
      loading.style.display = 'none'
    }

    // 获取当前地址位置
    function getCurrentPosition() {
      // navigator.geolocation.getCurrentPosition(success, failure)
      // success: 成功回调函数
      // failure: 失败回调函数
      navigator.geolocation.getCurrentPosition(pos => {
        const {latitude, longitude} = pos.coords		// 取得返回值中的经度和纬度
        addToResult({latitude, longitude})	
        hideLoading()
      }, () => {
        hideLoading()
        alert('获取位置失败')
      })
    }

    // 将结果写入系统剪贴板
    function writeClipboard() {
      // navigator.clipboard.writeText(text).then(success, failure)
      // text: 写入剪贴板的文本
      // success: 成功回调函数
      // failure: 失败回调函数
      navigator.clipboard.writeText(result.join('\n')).then(() => {
        alert('写入剪贴板成功')
      }, () => {
        alert('写入剪贴板失败')
      })
    }

    getCurrentPosition() 		// 页面加载时自动获取当前地理位置信息
  </script>
</body>
</html>
